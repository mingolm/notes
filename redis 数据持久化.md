## redis 数据持久化与数据迁移



#### 数据持久化

- RDB (快照)

  - 通过 save/ bgsave 两个命令可以触发，分别为同步和异步执行生成 rdb
  - 适合全局备份，生成的文件体积较小
  - 恢复相比 aof 速度更快
  - 二进制存储，不易阅读
  - 缺点是 fork 子进程进行备份时，大量占用 cpu 且阻塞，丢失的数据更多
  - 

- AOF（文件追加）

  - 默认每秒追加一次，即最多丢失 1s 的数据
  - 文件过大，到达阈值时会进行文件重写
  - redis 协议写入内容，易读

- 混合持久化（RDB+AOF 同时进行）

  - 通过 aof-use-rdb-preamble 配置，5.0 版本后默认开启
  - 全局备份创建 rdb 文件，另外追加写入 aof，性能与文件大小兼顾

  

  